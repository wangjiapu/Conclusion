


# 网络层

## ip协议：了解ip协议前先了解ip数据包的结构

![ip数据包结构](https://github.com/wangjiapu/Conclusion/blob/master/imge/WechatIMG17.jpeg)

通过上图可以清楚的看到，ip数据包包头最小长度为20个字节。

#### 版本：

通信双方使用的IP协议版本必须一致。目前广泛使用的IP协议版本号为4（即IPv4）

#### 首部长度：

占4位，可表示的最大十进制数值是15。请注意，这个字段所表示数的单位是32位字长（1个32位字长是4字节），
因此，当IP的首部长度为1111时（即十进制的15），首部长度就达到60字节。当IP分组的首部长度不是4字节的整数倍时，
必须利用最后的填充字段加以填充。因此数据部分永远在4字节的整数倍开始，这样在实现IP协议时较为方便。
首部长度限制为60字节的缺点是有时可能不够用。但这样做是希望用户尽量减少开销。最常用的首部长度就是20字节
（即首部长度为0101），这时不使用任何选项。

#### 区分服务：

暂时没有发现有什么用


#### 总长度：

首部+数据  数据包最大长度为65535；

#### 标识：

占16位。IP软件在存储器中维持一个计数器，每产生一个数据报，计数器就加1，并将此值赋给标识字段。
但这个“标识”并不是序号，因为IP是无连接服务，数据报不存在按序接收的问题。当数据报由于长度超过网络的MTU而必须分片时，
这个标识字段的值就被复制到所有的数据报的标识字段中。相同的标识字段的值使分片后的各数据报片最后能正确地重装成为原来的数据报。


#### 标志：

三位，但是只有两位有用
- 标志字段中的最低位记为MF(MoreFragment)。MF=1即表示后面“还有分片”的数据报。MF=0表示这已是若干数据报片中的最后一个
- 标志字段中间的一位记为DF(Don’tFragment)，意思是“不能分片”。只有当DF=0时才允许分片。

#### 片偏移：

占13位。片偏移指出：较长的分组在分片后，某片在原分组中的相对位置。也就是说，相对用户数据字段的起点，该片从何处开始。
片偏移以8个字节为偏移单位。这就是说，除了最后一个分片，每个分片的长度一定是8字节（64位）的整数倍。


#### 生存时间：

占八位

#### 协议：

占8位，协议字段指出此数据报携带的数据是使用何种协议，以便使目的主机的IP层知道应将数据部分上交给哪个处理过程

#### 首部校验和：

占16位。这个字段只检验数据报的首部，但不包括数据部分。
这是因为数据报每经过一个路由器，路由器都要重新计算一下首部检验和（一些字段，如生存时间、标志、片偏移等都可能发生变化）。
不检验数据部分可减少计算的工作量


#### 源地址 32位

#### 目的地址 32位



###  ip相关规定


1.网络地址、主机地址、广播地址

IP地址由“网络位+主机位”组成。

网络地址：主机位全0

主机地址：网络位全0

直接广播地址：主机位全1

举例：IP地址 201.161.20.18 的网络地址是201.161.20.0，主机地址是0.0.0.18，直接广播地址为201.161.20.255。

2.可用的IP地址

主机位不可全0或全1（全0是网络地址，全1是广播地址）

在一个网段内，最小的可用IP地址是“网络地址+1”，最大的可用IP地址是“广播地址-1”。

举例：192.168.1.0～192.168.1.255网段中，可用的IP地址是：192.168.1.1～192.168.1.254

3. 受限广播地址(或称为“有限广播地址”)

32位全1的IP地址(255.255.255.255)表示受限广播地址。

受限广播地址和直接广播地址的区别，举例：255.255.255.255和192.168.5.255。

交换机转发广播，路由器不转发广播。

### 子网掩码：

子网掩码用来区别网络位和主机位，用1表示网络位，用0表示主机位。比如：

A类IP地址的掩码：11111111.00000000.00000000.00000000  写成十进制 255.0.0.0

也可以用/8来表示，表示前8位是网络位，比如：10.3.3.3/8

B类IP地址的掩码：11111111.11111111.00000000.00000000  写成十进制 255.255.0.0

也可以用/16来表示，表示前16位是网络位，比如：172.16.7.6/16

C类IP地址的掩码：11111111.11111111.11111111.00000000  写成十进制 255.255.255.0

也可以用/24来表示，表示前24位是网络位，比如：192.168.5.8/24

子网掩码为255.255.255.255表示本网段只有1个IP地址，举例：电信运营商动态分配给用户的IP地址110.80.191.243和子网掩码255.255.255.255。

三、划分子网的三级网络结构

将一个大的网络划分成几个较小的子网，变成“网络位+子网位+主机位”的三级结构

### 计算：


将一个大的网络划分成几个较小的子网，变成“网络位+子网位+主机位”的三级结构。

（一）子网掩码的计算(★记住)

10000000→128  (借1位)

11000000→128＋64＝192  (借2位)

11100000→128＋64＋32＝224  (借3位)

11110000→128＋64＋32＋16＝240  (借4位)

11111000→128＋64＋32＋16＋8＝248  (借5位)

11111100→128＋64＋32＋16＋8＋4＝252  (借6位)

11111110→128＋64＋32＋16＋8＋4＋2＝254  (借7位)

11111111→128＋64＋32＋16＋8＋4＋2＋1＝255  (借8位)

（二）子网划分计算

向主机位借1位可以划分成2个子网，借2位划分成4个子网，借3位划分成8个子网，如下：

28＝256，27＝128，26＝64，25＝32，24＝16，23＝8，22＝4，21＝2

（三）举例

举例1：172.17.0.3/19子网掩码是多少 (借3位)

子网掩码11111111.11111111.11100000.00000000 即255.255.224.0

举例2：192.168.6.7/26子网掩码是多少 (借2位)

子网掩码11111111.11111111.11111111.11000000 即255.255.255.192

举例3：IP地址172.16.37.95，子网掩码为255.255.224.0，写出网络地址、主机地址和广播地址。

解答：224表示借3位，172.16.37.95→172.16.00100101.95；

网络地址：172.16.00100000.0→172.16.32.0   (主机位全0)

主机地址：0.0.00000101.95→0.0.5.95  (网络位全0)

广播地址：172.16.00111111.255→172.16.63.255   (主机位全1)

练习：写出以下IP地址的网络地址、主机地址和广播地址

172.16.99.8/255.255.240.0  (提示：172.16.01100011.8)

192.168.3.72/255.255.255.192 (提示：192.168.3.01001000)

10.33.4.5/255.248.0.0 (提示：10.00100001.4.5)

192.168.56.24/255.255.255.224

172.17.189.98/255.255.252.0

11.254.255.220/255.128.0.0


